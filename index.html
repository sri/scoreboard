<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Scoreboard</title>
<style type="text/css">
body {
  background: black;
  color: #aaa;
}
.container {
  display: flex;
}
.team {
  flex: 1;
  text-align:center;
}
.team:first-child {
  margin-right: 20px;
}
.boxscore {
  border: 1px solid #aaa;
  width: 400px;
}
.teamname {
  font-size: 40pt;
}
.score {
  display: flex;
}
.score .current {
  flex: 1;
  font-size: 222pt;
}
.score .twopointer, .score .threepointer {
  flex: 1;
  font-size: 30pt;
  color: #333;
}
.clock {
  flex: 1;
  color: #E1341E;
  font-weight: bold;
  text-align: center;
}
.gameclock {
  font-size: 54pt;
}
.shotclock {
  font-size: 44pt;
}
.fouls {
  font-size: 30pt;
}
.timeouts {
  font-size: 30pt;
}
.paused {
  border: 1px solid #E1341E;
}
.quarter, .overtime {
  font-size: 30pt;
}
.hidden {
  display: none;
}
</style>
<script type="text/javascript">
var MINS_PER_QUARTER = 4;
var MINS_PER_OVERTIME = 2;

function asInt(elt) {
  const value = parseInt(elt.innerHTML, 10);
  if (isNaN(value)) {
    return 0;
  }
  return value;
}

class Team {
  constructor(eltName) {
    this.elt = document.querySelector(eltName);
    this.scoreElt = this.elt.querySelector(".score .current");

    // this.elt.ontouchstart = () => this.incrementScore();
  }

  getCurrentScore() {
    return asInt(this.scoreElt);
  }

  threePointer(event) {
    if (event) event.preventDefault();
    this.incrementScore(3);

  }

  twoPointer(event) {
    if (event) event.preventDefault();
    this.incrementScore(2);
  }

  onePointer(event) {
    if (event) event.preventDefault();
    this.incrementScore(1);
  }

  incrementScore(n) {
    let currentScore = asInt(this.scoreElt);
    currentScore += n;
    CLOCK.scoreUpdatedCallback();
    this.scoreElt.innerHTML = currentScore + "";
  }
}

class Clock {
  constructor(eltName) {
    this.elt = document.querySelector(eltName);
    this.shotclockElt = this.elt.querySelector(".shotclock");

    this.gameClockElt = this.elt.querySelector(".gameclock");
    this.gameClockMinsElt = this.gameClockElt.querySelector(".mins");
    this.gameClockSecsElt = this.gameClockElt.querySelector(".secs");

    this.quarterElt = this.elt.querySelector(".quarter");
    this.quarterCurrentElt = this.quarterElt.querySelector(".current");
    this.overtimeElt = this.elt.querySelector(".overtime");
    this.overtimeCurrentElt = this.overtimeElt.querySelector(".current");

    this.paused = true;

    this.scoreUpdated = false;
  }

  togglePause(event) {
    if (event) event.preventDefault();

    this.paused = !this.paused;
    if (this.paused) {
      this.elt.classList.add("paused")
    } else {
      this.elt.classList.remove("paused")
    }
  }

  scoreUpdatedCallback() {
    this.scoreUpdated = true;
  }

  updateClock() {
    let mins = asInt(this.gameClockMinsElt);
    let secs = asInt(this.gameClockSecsElt);

    secs -= 1;

    let shotclock = asInt(this.shotclockElt);
    if (mins === 0 && secs <= 24) {
      // If game clock < 24, don't show shot clock.
      shotclock = "-";
    } else if (this.scoreUpdated) {
      shotclock = 24;
      this.scoreUpdated = false;
    } else {
      shotclock -= 1;
    }
    if (shotclock < 0) {
      shotclock = 24;
    }
    this.shotclockElt.innerHTML = shotclock;

    if (secs < 0) {
      mins -= 1;
      secs = 59;
    }
    if (mins < 0) {
      let quarter = asInt(this.quarterCurrentElt);
      if (quarter < 4) {
        quarter += 1;
        mins = MINS_PER_QUARTER;
        secs = 0;
        this.quarterCurrentElt.innerHTML = quarter;
      } else if (HOME.getCurrentScore() === AWAY.getCurrentScore()) {
        // Overtime
        this.quarterElt.classList.add("hidden");
        this.overtimeElt.classList.remove("hidden");

        let overtime = asInt(this.overtimeCurrentElt) + 1;
        mins = MINS_PER_OVERTIME;
        secs = 0;
        this.overtimeCurrentElt.innerHTML = overtime;
      } else {
        // Game over -- we don't stop the interval that keeps
        // calling this method. If score at some point becomes the same,
        // overtime starts (buzzer beater occurs, and a few seconds later,
        // after a "review", score is incremented).
        return;
      }
    }

    this.gameClockMinsElt.innerHTML = this.format2digit(mins);
    this.gameClockSecsElt.innerHTML = this.format2digit(secs);
  }

  format2digit(n) {
    if (n < 10) return '0' + n;
    return n;
  }

  update() {
    if (!this.paused) {
      this.updateClock();
    }
  }

  init() {
    setInterval(() => this.update(), 1000);
  }
}

var CLOCK;
var HOME;
var AWAY;

function Init() {
  HOME = new Team(".hometeam");
  AWAY = new Team(".awayteam");

  CLOCK = new Clock(".clock");
  CLOCK.init();
}

</script>
</head>
<body onload="Init()">
  <div class="container">
    <div class="team hometeam">
      <div class="boxscore">
        <div class="teamname">Milwaukee Bucks</div>
        <div class="score">
          <div class="twopointer" onTouchStart="HOME.twoPointer(event)" onClick="HOME.twoPointer()">+2</div>
          <div class="current" onTouchStart="HOME.onePointer(event)" onClick="HOME.onePointer()">0</div>
          <div class="threepointer" onTouchStart="HOME.threePointer(event)" onClick="HOME.threePointer()">+3</div>
        </div>
      </div>
    </div>

    <div class="clock paused" onTouchStart="CLOCK.togglePause(event)" onclick="CLOCK.togglePause()">
      <div class="gameclock">
        <span class="mins">4</span>:<span class="secs">00</span>
      </div>
      <div class="shotclock">24</div>
      <div class="quarter">Quarter <span class="current">1</span></div>
      <div class="overtime hidden">Overtime <span class="current">0</span></div>
    </div>

    <div class="team awayteam">
      <div class="boxscore">
        <div class="teamname">Sacremento Kings</div>
        <div class="score">
          <div class="twopointer" onTouchStart="AWAY.twoPointer(event)" onClick="AWAY.twoPointer()">+2</div>
          <div class="current" onTouchStart="AWAY.onePointer(event)" onClick="AWAY.onePointer()">0</div>
          <div class="threepointer" onTouchStart="AWAY.threePointer(event)" onClick="AWAY.threePointer()">+3</div>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
