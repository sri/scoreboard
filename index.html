<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
<title>Scoreboard</title>
<style type="text/css">
 html, body, .box {
   font-family: 'Ubuntu', serif;
   background: #0a0a0f;
 }
 .modal-card {
   background: #1a1a24;
 }
 .modal-card-head {
   background: linear-gradient(145deg, #2a2a38 0%, #1a1a24 100%);
   border-bottom: 2px solid #FF8C00;
 }
 .modal-card-title {
   color: #FFD700;
   font-weight: 700;
   font-size: 24pt;
 }
 .modal-card-body {
   background: #1a1a24;
   color: #E8E8E8;
 }
 .modal-card-foot {
   background: #1a1a24;
   border-top: 1px solid #3a3a4a;
 }
 .teams {
   padding: 20px;
 }
 .teams .field {
   display: grid !important;
   grid-template-columns: repeat(2, 1fr) !important;
   gap: 12px !important;
 }
 .teams button {
   padding: 16px 20px;
   border: 2px solid transparent;
   border-radius: 8px;
   font-size: 14pt;
   font-weight: 700;
   color: #ffffff;
   text-align: left;
   transition: all 0.2s ease;
   cursor: pointer;
   text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
   box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
   background: #3a3a4a;
 }
 .teams button.is-primary {
   border-color: #FFD700;
   box-shadow: 0 0 20px rgba(255, 215, 0, 0.4), 0 4px 12px rgba(0, 0, 0, 0.6);
   transform: scale(1.05);
 }
 .selected, .selected:active {
   color: green;
 }
 .score {
   font-size: 180pt;
   text-align: center;
   border-radius: 12px;
   background: linear-gradient(145deg, #1a1a24 0%, #0f0f18 100%);
   box-shadow:
     0 0 30px rgba(255, 140, 0, 0.3),
     0 8px 32px rgba(0, 0, 0, 0.6),
     inset 0 1px 0 rgba(255, 140, 0, 0.2),
     inset 0 -2px 8px rgba(0, 0, 0, 0.4);
   padding: 20px 0;
   font-weight: 900;
   letter-spacing: -8px;
   color: #E8E8E8;
   text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
   position: relative;
   user-select: none;
   -webkit-user-select: none;
   -moz-user-select: none;
   -ms-user-select: none;
   cursor: pointer;
 }
 .teamname {
   text-align: center;
   font-size: 24pt;
   text-transform: uppercase;
   font-weight: 900;
   color: #ffffff;
   text-shadow: 0 2px 8px rgba(0, 0, 0, 0.8);
   padding: 10px 0;
   letter-spacing: 1px;
   cursor: pointer;
   transition: all 0.2s ease;
   border-radius: 8px;
   position: relative;
 }
 .teamname:hover {
   transform: scale(1.05);
   filter: brightness(1.2);
   box-shadow: 0 4px 16px rgba(0, 0, 0, 0.6);
 }
 .ball-indicator {
   position: absolute;
   right: 20px;
   top: 50%;
   transform: translateY(-50%);
   font-size: 28pt;
   opacity: 0;
   transition: opacity 0.3s ease;
   filter: drop-shadow(0 0 10px rgba(255, 140, 0, 0.8));
   animation: pulse 1.5s ease-in-out infinite;
 }
 .ball-indicator.active {
   opacity: 1;
 }
 @keyframes pulse {
   0%, 100% {
     filter: drop-shadow(0 0 10px rgba(255, 140, 0, 0.8));
   }
   50% {
     filter: drop-shadow(0 0 20px rgba(255, 140, 0, 1));
   }
 }

 .gameclock {
   color: #FF4444;
   font-size: 54pt;
   text-align: center;
   font-weight: 700;
   text-shadow:
     0 0 20px rgba(255, 68, 68, 0.8),
     0 2px 4px rgba(0, 0, 0, 0.8);
 }
 .shotclock {
   color: #000000;
   font-size: 52pt;
   text-align: center;
   background: linear-gradient(145deg, #FFFFFF 0%, #F5F5F5 100%);
   border: 6px solid #FF6600;
   border-radius: 12px;
   width: 140px;
   height: 140px;
   display: flex;
   align-items: center;
   justify-content: center;
   margin: 0 auto;
   font-weight: 900;
   box-shadow:
     0 0 30px rgba(255, 102, 0, 0.7),
     0 4px 16px rgba(0, 0, 0, 0.6),
     inset 0 2px 4px rgba(255, 102, 0, 0.3),
     inset 0 -2px 4px rgba(0, 0, 0, 0.1);
 }
 .period {
   text-align: center;
   font-size: 32pt;
   color: #FFD700;
   font-weight: 700;
   text-shadow:
     0 0 10px rgba(255, 215, 0, 0.5),
     0 2px 4px rgba(0, 0, 0, 0.8);
 }
 .twopointer {
   border-radius: 12px;
   height: 125px;
   background: linear-gradient(145deg, #1a1a24 0%, #0f0f18 100%);
   color: #ffffff;
   font-size: 22pt;
   font-weight: 900;
   text-transform: uppercase;
   letter-spacing: 2px;
   box-shadow:
     0 0 20px rgba(37, 99, 235, 0.4),
     0 4px 16px rgba(0, 0, 0, 0.5),
     inset 0 1px 0 rgba(255, 255, 255, 0.2);
   transition: all 0.15s ease;
   cursor: pointer;
   text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
 }
 .threepointer {
   border-radius: 12px;
   height: 125px;
   background: linear-gradient(145deg, #1a1a24 0%, #0f0f18 100%);
   color: #ffffff;
   font-size: 22pt;
   font-weight: 900;
   text-transform: uppercase;
   letter-spacing: 2px;
   box-shadow:
     0 0 20px rgba(249, 115, 22, 0.4),
     0 4px 16px rgba(0, 0, 0, 0.5),
     inset 0 1px 0 rgba(255, 255, 255, 0.2);
   transition: all 0.15s ease;
   cursor: pointer;
   text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
 }
 .twopointer:hover {
   background: linear-gradient(145deg, #3B82F6 0%, #2563EB 100%);
   border-color: #60A5FA;
   transform: translateY(-3px);
   box-shadow:
     0 0 30px rgba(59, 130, 246, 0.6),
     0 6px 20px rgba(0, 0, 0, 0.6),
     inset 0 1px 0 rgba(255, 255, 255, 0.3);
 }
 .threepointer:hover {
   background: linear-gradient(145deg, #FB923C 0%, #F97316 100%);
   border-color: #FBBF24;
   transform: translateY(-3px);
   box-shadow:
     0 0 30px rgba(251, 146, 60, 0.6),
     0 6px 20px rgba(0, 0, 0, 0.6),
     inset 0 1px 0 rgba(255, 255, 255, 0.3);
 }
 .twopointer:active, .threepointer:active {
   transform: translateY(0);
   box-shadow:
     0 0 15px rgba(0, 0, 0, 0.4),
     0 2px 8px rgba(0, 0, 0, 0.6),
     inset 0 2px 4px rgba(0, 0, 0, 0.3);
 }
 .paused {
   border: 3px solid #FF4444;
   box-shadow: 0 0 30px rgba(255, 68, 68, 0.5);
 }
 .audio-toggle, .mic-toggle {
   width: 60px;
   height: 60px;
   border-radius: 50%;
   border: 3px solid #3a3a4a;
   background: linear-gradient(145deg, #1a1a24 0%, #0f0f18 100%);
   color: #888;
   font-size: 28pt;
   cursor: pointer;
   display: inline-flex;
   align-items: center;
   justify-content: center;
   transition: all 0.3s ease;
   box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
   user-select: none;
   margin: 0 10px;
   position: relative;
 }
 .audio-toggle.enabled, .mic-toggle.enabled {
   border-color: #10B981;
   color: #10B981;
   box-shadow: 0 0 20px rgba(16, 185, 129, 0.4), 0 4px 12px rgba(0, 0, 0, 0.5);
 }
 .mic-toggle:not(.enabled)::after {
   content: '';
   position: absolute;
   width: 50px;
   height: 3px;
   background: #FF4444;
   transform: rotate(-45deg);
   box-shadow: 0 0 8px rgba(255, 68, 68, 0.8);
 }
 .audio-toggle:hover, .mic-toggle:hover {
   transform: scale(1.1);
 }
 .audio-toggle:active, .mic-toggle:active {
   transform: scale(0.95);
 }
</style>
<script type="text/javascript">
 const MINS_PER_QUARTER = 12;
 const MINS_PER_OVERTIME = 5;

 // Check if device is iPad
 function isIPad() {
   return (navigator.userAgent.match(/iPad/i) != null) ||
          (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
 }

 // Audio enabled state - default true on iPad, false otherwise
 let AUDIO_ENABLED = isIPad();

 // Mic enabled state - default false, only enable when user requests
 let MIC_ENABLED = false;
 let SPEECH_RECOGNITION = null;

 const TEAMS = [
   'Atlanta Hawks',
   'Boston Celtics',
   'Brooklyn Nets',
   'Charlotte Hornets',
   'Chicago Bulls',
   'Cleveland Cavaliers',
   'Dallas Mavericks',
   'Denver Nuggets',
   'Detroit Pistons',
   'Golden State Warriors',
   'Houston Rockets',
   'Indiana Pacers',
   'Los Angeles Clippers',
   'Los Angeles Lakers',
   'Memphis Grizzlies',
   'Miami Heat',
   'Milwaukee Bucks',
   'Minnesota Timberwolves',
   'New Orleans Pelicans',
   'New York Knicks',
   'Oklahoma City Thunder',
   'Orlando Magic',
   'Philadelphia 76ers',
   'Phoenix Suns',
   'Portland Trail Blazers',
   'Sacramento Kings',
   'San Antonio Spurs',
   'Toronto Raptors',
   'Utah Jazz',
   'Washington Wizards',
   'Team USA',
   'Team Germany',
   'Team France',
   'Team Canada',
   'Team YMCA 1',
   'Team YMCA 2',
 ];

 const TEAM_COLORS = {
   'Atlanta Hawks': '#E03A3E',
   'Boston Celtics': '#007A33',
   'Brooklyn Nets': '#000000',
   'Charlotte Hornets': '#1D1160',
   'Chicago Bulls': '#CE1141',
   'Cleveland Cavaliers': '#860038',
   'Dallas Mavericks': '#00538C',
   'Denver Nuggets': '#0E2240',
   'Detroit Pistons': '#C8102E',
   'Golden State Warriors': '#1D428A',
   'Houston Rockets': '#CE1141',
   'Indiana Pacers': '#002D62',
   'Los Angeles Clippers': '#C8102E',
   'Los Angeles Lakers': '#552583',
   'Memphis Grizzlies': '#5D76A9',
   'Miami Heat': '#98002E',
   'Milwaukee Bucks': '#00471B',
   'Minnesota Timberwolves': '#0C2340',
   'New Orleans Pelicans': '#0C2340',
   'New York Knicks': '#006BB6',
   'Oklahoma City Thunder': '#007AC1',
   'Orlando Magic': '#0077C0',
   'Philadelphia 76ers': '#006BB6',
   'Phoenix Suns': '#E56020',
   'Portland Trail Blazers': '#E03A3E',
   'Sacramento Kings': '#5A2D81',
   'San Antonio Spurs': '#C4CED4',
   'Toronto Raptors': '#CE1141',
   'Utah Jazz': '#002B5C',
   'Washington Wizards': '#002B5C',
   'Team USA': '#BF0A30',
   'Team Germany': '#000000',
   'Team France': '#002395',
   'Team Canada': '#FF0000',
   'Team YMCA 1': '#00539F',
   'Team YMCA 2': '#E4002B',
   'Team LeBron': '#FDB927',
   'Team Curry': '#006BB6',
   'Team G': '#00A94F',
 };

 function asInt(arg) {
   const value = parseInt(arg, 10);
   if (isNaN(value)) {
     return 0;
   }
   return value;
 }

 function updateBallIndicator() {
   const homeBall = document.querySelector('.home-ball');
   const awayBall = document.querySelector('.away-ball');

   if (TEAM_WITH_BALL === HOME) {
     homeBall.classList.add('active');
     awayBall.classList.remove('active');
   } else {
     awayBall.classList.add('active');
     homeBall.classList.remove('active');
   }
 }

 function toggleAudio() {
   AUDIO_ENABLED = !AUDIO_ENABLED;
   const toggleBtn = document.querySelector('.audio-toggle');
   if (AUDIO_ENABLED) {
     toggleBtn.classList.add('enabled');
     toggleBtn.innerHTML = 'üîä';
   } else {
     toggleBtn.classList.remove('enabled');
     toggleBtn.innerHTML = 'üîá';
     // Stop any currently playing audio
     if (CROWD_SOUND) {
       CROWD_SOUND.stop();
     }
   }
 }

 function toggleMic() {
   MIC_ENABLED = !MIC_ENABLED;
   const toggleBtn = document.querySelector('.mic-toggle');

   if (MIC_ENABLED) {
     toggleBtn.classList.add('enabled');
     toggleBtn.innerHTML = 'üé§';
     // Initialize and start speech recognition
     initSpeechRecognition();
   } else {
     toggleBtn.classList.remove('enabled');
     toggleBtn.innerHTML = 'üéôÔ∏è';
     // Stop speech recognition
     if (SPEECH_RECOGNITION) {
       SPEECH_RECOGNITION.stop();
     }
   }
 }

 function initSpeechRecognition() {
   const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

   if (!SpeechRecognition) {
     alert('Speech recognition is not supported in this browser. Please use Chrome or Safari (iOS 14.5+).');
     MIC_ENABLED = false;
     document.querySelector('.mic-toggle').classList.remove('enabled');
     return;
   }

   SPEECH_RECOGNITION = new SpeechRecognition();
   SPEECH_RECOGNITION.continuous = true;
   SPEECH_RECOGNITION.interimResults = false;
   SPEECH_RECOGNITION.lang = 'en-US';

   let finalTranscript = '';

   // Start recognition
   try {
     SPEECH_RECOGNITION.start();
   } catch (e) {
     console.error('Error starting recognition:', e);
     alert(`Error starting recognition: ${e}`);
   }

   // Handle results
   SPEECH_RECOGNITION.onresult = (event) => {
     for (let i = event.resultIndex; i < event.results.length; i++) {
       const transcriptPiece = event.results[i][0].transcript;
       if (event.results[i].isFinal) {
         finalTranscript = transcriptPiece + ' ';
       }
     }

     console.log("got final", finalTranscript);
     if (/two|2/i.test(finalTranscript)) {
       TEAM_WITH_BALL.twoPointer();
     } else if (/three|3/i.test(finalTranscript)) {
       TEAM_WITH_BALL.threePointer();
     }
   };

   // Handle errors
   SPEECH_RECOGNITION.onerror = (event) => {
     console.error('Recognition error:', event.error);
     if (event.error === 'not-allowed') {
       alert('Microphone access denied. Please allow microphone access to use voice commands.');
       MIC_ENABLED = false;
       document.querySelector('.mic-toggle').classList.remove('enabled');
       document.querySelector('.mic-toggle').innerHTML = 'üéôÔ∏è';
     }
   };

   // Handle end of recognition
   SPEECH_RECOGNITION.onend = () => {
     // Restart if still enabled
     if (MIC_ENABLED) {
       try {
         SPEECH_RECOGNITION.start();
       } catch (e) {
         console.error('Error restarting recognition:', e);
       }
     }
   };
 }

 class Team {
   constructor(eltName) {
     this.elt = document.querySelector(eltName);
     this.scoreElt = this.elt.querySelector(".score");
     this.otherTeam = null;
   }

   reset() {
     this.scoreElt.innerHTML = "0";
   }

   getCurrentScore() {
     return asInt(this.scoreElt.innerHTML);
   }

   setCurrentScore(score) {
     this.scoreElt.innerHTML = score;
   }

   threePointer(event) {
     if (event) event.preventDefault();
     this.incrementScore(3);
     CROWD_SOUND.play();
     TEAM_WITH_BALL = this.otherTeam;
     updateBallIndicator();
   }

   twoPointer(event) {
     if (event) event.preventDefault();
     this.incrementScore(2);
     TEAM_WITH_BALL = this.otherTeam;
     updateBallIndicator();
   }

   onePointer(event) {
     if (event) event.preventDefault();
     this.incrementScore(1);
   }

   incrementScore(n) {
     let currentScore = asInt(this.scoreElt.innerHTML);
     currentScore += n;
     CLOCK.scoreUpdatedCallback();
     this.scoreElt.innerHTML = currentScore + "";
   }

   setOtherTeam(other) {
     this.otherTeam = other;
   }
 }

 let BUZZER = null;

 function BuzzerInit() {
   if (BUZZER) return;
   BUZZER = new Audio();
   BUZZER.play();
 }

 function Buzzer() {
   BUZZER.src = 'buzzer.mp3';
   BUZZER.volume = 0.1;
   BUZZER.play();
 }

 const ALL_CROWD_SOUNDS = [
   'bulls',
   /* 'celtics',
    * 'hawks',
    * 'nuggets',
    * 'okc',
    * 'raptors',
    * 'rockets',
    * 'warriors' */
 ];

 class CrowdSound {
   constructor() {
     this.sounds = ALL_CROWD_SOUNDS.map((x) => x);
     this.shuffle(this.sounds);
     this.audio = null;
     this.idx = 0;
   }

   play() {
     // Check if audio is enabled
     if (!AUDIO_ENABLED) {
       return;
     }

     if (this.audio === null) {
       console.log("intializing audio...");
       this.audio = new Audio();
       console.log("intializing audio...done");
     }

     if (!this.audio.paused) {
       // If already playing, don't try to play again.
       console.log('paused');
       return;
     }

     if (this.idx >= this.sounds.length) {
       this.idx = 0;
     }

     const nextSound = this.sounds[this.idx];

     console.log('nextSound', nextSound);
     this.audio.src = `crowd_sounds/${nextSound}.mp3`;
     this.audio.volume = 0.3;
     this.audio.play();

     this.idx += 1;
   }

   stop() {
     if (this.audio.paused) return;
     this.audio.pause();
     this.audio.currentTime = 0;
   }

   // https://stackoverflow.com/questions/2450954/how-to-randomize-shuffle-a-javascript-array
   shuffle(array) {
     for (var i = array.length - 1; i > 0; i--) {
       var j = Math.floor(Math.random() * (i + 1));
       var temp = array[i];
       array[i] = array[j];
       array[j] = temp;
     }
   }
 }

 class Clock {
   constructor(eltName) {
     this.elt = document.querySelector(eltName);
     this.shotclockElt = this.elt.querySelector(".shotclock");

     this.gameClockElt = this.elt.querySelector(".gameclock");
     this.gameClockMinsElt = this.gameClockElt.querySelector(".mins");
     this.gameClockSecsElt = this.gameClockElt.querySelector(".secs");

     this.quarterElt = this.elt.querySelector(".quarter");
     this.quarterCurrentElt = this.quarterElt.querySelector(".current");
     this.overtimeElt = this.elt.querySelector(".overtime");
     this.overtimeCurrentElt = this.overtimeElt.querySelector(".current");

     this.paused = true;

     this.scoreUpdated = false;

     this.interval = null;
   }

   nextQuarter() {
     let quarter = asInt(this.quarterCurrentElt.innerHTML);
     this.quarterCurrentElt.innerHTML = quarter + 1;
   }

   reset() {
     this.pause();
     this.shotclockElt.innerHTML = "24";
     this.gameClockMinsElt.innerHTML = IsTest() ? 0 : MINS_PER_QUARTER;
     this.gameClockSecsElt.innerHTML = IsTest() ? "10" : "00";
     this.quarterCurrentElt.innerHTML = "1";
     this.quarterElt.classList.remove("is-hidden");
     this.overtimeElt.classList.add("is-hidden");
     this.overtimeCurrentElt.innerHTML = "0";
   }

   setQuarter(val) {
     this.quarterCurrentElt.innerHTML = val;
   }

   setTime(mins, secs)  {
     this.gameClockMinsElt.innerHTML = mins;
     this.gameClockSecsElt.innerHTML = secs;
   }

   togglePause(event) {
     if (event) event.preventDefault();
     BuzzerInit();
     this.doPause();
   }

   doPause() {
     this.paused = !this.paused;
     if (this.paused) {
       clearInterval(this.interval);
       this.elt.classList.add("paused")
       CROWD_SOUND.stop();
     } else {
       this.elt.classList.remove("paused")
       this.interval = setInterval(() => this.update(), 1000);
     }
   }

   pause() {
     if (this.paused) return;
     this.doPause();
   }

   scoreUpdatedCallback() {
     if (this.paused) return;
     // This will reset the shotclock.
     this.scoreUpdated = true;
   }

   updateClock() {
     let mins = asInt(this.gameClockMinsElt.innerHTML);
     let secs = asInt(this.gameClockSecsElt.innerHTML);
     let quarter = asInt(this.quarterCurrentElt.innerHTML);

     let shotclock = parseInt(this.shotclockElt.innerHTML, 10);
     if (isNaN(shotclock)) {
       shotclock = 0;
     } else {
       shotclock -= 1
       if (shotclock === 0) {
         Buzzer();
       }
     }

     secs -= 1;

     if (secs < 0) {
       mins -= 1;
       secs = 59;
     }

     if (shotclock <= 0) {
       shotclock = 24;
     }

     if (mins <= 2) {
       CROWD_SOUND.play();
     }

     if (mins < 0) {
       CLOCK.pause();

       if (quarter < 4) {
         quarter += 1;
         mins = IsTest() ? 0 : MINS_PER_QUARTER;
         secs = IsTest() ? 10 : 0;
         shotclock = 24;

         this.quarterCurrentElt.innerHTML = quarter;
       } else if (HOME.getCurrentScore() === AWAY.getCurrentScore()) {
         mins = IsTest() ? 0 : MINS_PER_OVERTIME;
         secs = IsTest() ? 10 : 0;
         shotclock = 24;

         // Overtime
         this.quarterElt.classList.add("is-hidden");
         this.overtimeElt.classList.remove("is-hidden");

         let overtime = asInt(this.overtimeCurrentElt.innerHTML) + 1;
         this.overtimeCurrentElt.innerHTML = overtime;
       } else {
         // Game over -- we don't stop the interval that keeps
         // calling this method. If score at some point becomes the same,
         // overtime starts (buzzer beater occurs, and a few seconds later,
         // after a "review", score is incremented).
         CROWD_SOUND.stop();
         return;
       }
     }

     if (mins === 0 && secs === 0) {
       Buzzer();
       CROWD_SOUND.stop();
     }

     if (mins === 0 && shotclock >= secs) {
       shotclock = "-";
     } else if (this.scoreUpdated) {
       // Reset shotclock when someone scores.
       shotclock = 24;
       this.scoreUpdated = false;
     }

     this.shotclockElt.innerHTML = shotclock;
     this.gameClockMinsElt.innerHTML = this.format2digit(mins);
     this.gameClockSecsElt.innerHTML = this.format2digit(secs);
   }

   format2digit(n) {
     if (n < 10) return '0' + n;
     return n;
   }

   update() {
     if (!this.paused) {
       this.updateClock();
     }
   }
 }


 function IsTest() {
   return window.location.search === "?t";
 }

 let CLOCK,
     HOME,
     AWAY,
     TEAM_SELECTOR,
     CROWD_SOUND,
     TEAM_WITH_BALL;

 function Init() {
   HOME = new Team(".hometeam");
   AWAY = new Team(".awayteam");
   TEAM_WITH_BALL = HOME;
   HOME.setOtherTeam(AWAY);
   AWAY.setOtherTeam(HOME);
   HOME.reset();
   AWAY.reset();

   CLOCK = new Clock(".clock");
   CLOCK.reset()

   TEAM_SELECTOR = new TeamSelector();

   CROWD_SOUND = new CrowdSound();

   // Set initial team colors
   const homeTeamName = document.querySelector(".hometeamname").innerHTML;
   const awayTeamName = document.querySelector(".awayteamname").innerHTML;
   if (TEAM_COLORS[homeTeamName]) {
     document.querySelector(".hometeamname").style.background = TEAM_COLORS[homeTeamName];
   }
   if (TEAM_COLORS[awayTeamName]) {
     document.querySelector(".awayteamname").style.background = TEAM_COLORS[awayTeamName];
   }

   // Set initial ball indicator
   updateBallIndicator();

   // Initialize audio toggle button state
   const audioToggle = document.querySelector('.audio-toggle');
   if (AUDIO_ENABLED) {
     audioToggle.classList.add('enabled');
     audioToggle.innerHTML = 'üîä';
   } else {
     audioToggle.innerHTML = 'üîá';
   }

   window.addEventListener("beforeunload", function (e) {
     if (IsTest()) return null;
     var confirmationMessage = 'If you leave, your game will be lost.';
     (e || window.event).returnValue = confirmationMessage; //Gecko + IE
     return confirmationMessage; //Gecko + Webkit, Safari, Chrome etc.
   });
 }

 class TeamSelector {
   constructor() {
     this.modal = document.querySelector(".modal");
     this.populateTeams();
     this.allTeams = document.querySelectorAll(".modal .teams button");
   }

   populateTeams() {
     const teamsContainer = document.querySelector(".modal .teams .field");
     teamsContainer.innerHTML = '';

     // Sort teams alphabetically
     const sortedTeams = [...TEAMS].sort();

     sortedTeams.forEach(team => {
       const button = document.createElement('button');
       button.className = 'button';
       button.textContent = team;
       button.onclick = () => this.selectTeam(button);

       // Store team name as data attribute for later color application
       button.dataset.team = team;

       teamsContainer.appendChild(button);
     });
   }

   deselectAll() {
     for (let i = 0; i < this.allTeams.length; i += 1) {
       this.allTeams[i].classList.remove("is-primary");
       // Reset to gray background
       this.allTeams[i].style.background = '#3a3a4a';
     }
   }

   getAllSelected() {
     const result = [];
     for (let i = 0; i < this.allTeams.length; i += 1) {
       if (this.allTeams[i].classList.contains("is-primary")) {
         result.push(this.allTeams[i].innerHTML);
       }
     }
     return result;
   }

   changeTeams() {
     if (!this.modal.classList.contains("is-active")) {
       CLOCK.pause();
       this.modal.classList.add("is-active");
       return;
     }

     const selected = this.getAllSelected();
     this.modal.classList.remove("is-active");
     this.deselectAll();

     if (selected.length === 2) {
       var home = selected[0];
       var away = selected[1];
       const homeElt = document.querySelector(".hometeamname");
       const awayElt = document.querySelector(".awayteamname");

       // Update team names while preserving ball indicators
       const homeBall = homeElt.querySelector('.home-ball');
       const awayBall = awayElt.querySelector('.away-ball');
       homeElt.innerHTML = home;
       awayElt.innerHTML = away;
       homeElt.appendChild(homeBall);
       awayElt.appendChild(awayBall);

       // Apply team colors as background
       if (TEAM_COLORS[home]) {
         homeElt.style.background = TEAM_COLORS[home];
       }
       if (TEAM_COLORS[away]) {
         awayElt.style.background = TEAM_COLORS[away];
       }

       HOME.reset();
       AWAY.reset();
       CLOCK.reset();

       // Reset ball possession to home team
       TEAM_WITH_BALL = HOME;
       updateBallIndicator();
     }

     this.setStartingScore(HOME, "#starting-score-team1");
     this.setStartingScore(AWAY, "#starting-score-team2");
     this.setStartingQuarter("#starting-quarter");
     this.setStartingTime("#starting-time");
   }

   setStartingTime(eltId) {
     const elt = document.querySelector(eltId);
     const value = elt.value.trim();
     if (value === "") return;
     const mins = value.substr(0, 2);
     const secs = value.substr(2, 2);
     CLOCK.setTime(mins, secs);
   }

   setStartingQuarter(eltId) {
     const elt = document.querySelector(eltId);
     const value = elt.value.trim();
     if (value === "") return;
     CLOCK.setQuarter(asInt(value));
   }

   setStartingScore(team, eltId) {
     const elt = document.querySelector(eltId);
     const value = elt.value.trim();
     if (value === "") return;
     team.setCurrentScore(asInt(value));
     elt.value = "";
   }

   selectTeam(elt) {
     if (elt.classList.contains("is-primary")) {
       elt.classList.remove("is-primary");
       // Reset to gray when deselected
       elt.style.background = '#3a3a4a';
     } else {
       if (this.getAllSelected().length === 2) this.deselectAll();
       elt.classList.add("is-primary");

       // Apply team color when selected
       const teamName = elt.dataset.team;
       if (TEAM_COLORS[teamName]) {
         elt.style.background = TEAM_COLORS[teamName];
       }
     }
   }

   selectRandomTeams() {
     // Get two random teams
     const shuffled = [...TEAMS].sort(() => Math.random() - 0.5);
     const home = shuffled[0];
     const away = shuffled[1];

     // Update team names while preserving ball indicators
     const homeElt = document.querySelector(".hometeamname");
     const awayElt = document.querySelector(".awayteamname");
     const homeBall = homeElt.querySelector('.home-ball');
     const awayBall = awayElt.querySelector('.away-ball');
     homeElt.innerHTML = home;
     awayElt.innerHTML = away;
     homeElt.appendChild(homeBall);
     awayElt.appendChild(awayBall);

     // Apply team colors as background
     if (TEAM_COLORS[home]) {
       homeElt.style.background = TEAM_COLORS[home];
     }
     if (TEAM_COLORS[away]) {
       awayElt.style.background = TEAM_COLORS[away];
     }

     // Reset scores and clock
     HOME.reset();
     AWAY.reset();
     CLOCK.reset();

     // Reset ball possession to home team
     TEAM_WITH_BALL = HOME;
     updateBallIndicator();

     // Close modal and deselect teams
     this.modal.classList.remove("is-active");
     this.deselectAll();
   }
 }
</script>
</head>
<body onload="Init()">
  <div class="columns is-gapless is-vcentered">
    <div class="column is-two-fifths hometeam">
      <div class="tile is-ancestor">
        <div class="tile is-vertical is-parent">
          <div class="tile is-child">
            <div class="teamname hometeamname" onClick="TEAM_SELECTOR.changeTeams()">
              Portland Trail Blazers
              <span class="ball-indicator home-ball">üèÄ</span>
            </div>
          </div>
          <div class="tile is-child">
            <div class="score" onTouchStart="HOME.onePointer(event)" onClick="HOME.onePointer()">0</div>
          </div>
          <div class="tile is-parent">
            <div class="tile is-child">
              <a class="button is-large is-fullwidth twopointer" onTouchStart="HOME.twoPointer(event)" onClick="HOME.twoPointer()">
                +2pt
              </a>
            </div>
            <div class="tile is-child">
              <a class="button is-large is-fullwidth threepointer" onTouchStart="HOME.threePointer(event)" onClick="HOME.threePointer()">
                +3pt
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="column is-one-fifths clock paused" onTouchStart="CLOCK.togglePause(event)" onclick="CLOCK.togglePause()" id="clock-t">
      <div class="tile is-ancestor">
        <div class="tile is-vertical is-parent">
          <div class="tile is-child">
            <div class="gameclock">
              <span class="mins">4</span>:<span class="secs">00</span>
            </div>
          </div>
          <div class="tile is-child">
            <div class="shotclock">
              24
            </div>
          </div>
          <div class="tile is-child period">
            <div class="quarter">Q<span class="current" onClick="CLOCK.nextQuarter()">1</span></div>
            <div class="overtime is-hidden">Overtime <span class="current">0</span></div>
          </div>
        </div>
      </div>
    </div>

    <div class="column is-two-fifths awayteam">
      <div class="tile is-ancestor">
        <div class="tile is-vertical is-parent">
          <div class="tile is-child">
            <div class="teamname awayteamname" onClick="TEAM_SELECTOR.changeTeams()">
              Los Angeles Lakers
              <span class="ball-indicator away-ball">üèÄ</span>
            </div>
          </div>
          <div class="tile is-child">
            <div class="score" onTouchStart="AWAY.onePointer(event)" onClick="AWAY.onePointer()">0</div>
          </div>
          <div class="tile is-parent">
            <div class="tile is-child">
              <a class="button is-large is-fullwidth twopointer" onTouchStart="AWAY.twoPointer(event)" onClick="AWAY.twoPointer()">
                +2pt
              </a>
            </div>
            <div class="tile is-child">
              <a class="button is-large is-fullwidth threepointer" onTouchStart="AWAY.threePointer(event)" onClick="AWAY.threePointer()">
                +3pt
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div style="text-align: center; margin-top: 20px;">
    <button class="audio-toggle" onclick="toggleAudio()" title="Toggle audio">üîá</button>
    <button class="mic-toggle" onclick="toggleMic()" title="Toggle voice commands">üéôÔ∏è</button>
  </div>

  <div class="modal">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title">Select Teams</p>
        <button class="delete" aria-label="close" onClick="TEAM_SELECTOR.modal.classList.remove('is-active')"></button>
      </header>
      <section class="modal-card-body teams">
        <div class="field is-grouped is-grouped-multiline">
          <!-- Teams will be populated dynamically -->
        </div>
      </section>
      <section class="modal-card-body" style="padding: 20px;">
        <div class="field">
          <label class="label" style="color: #FFD700; font-weight: 600;">Starting Score - Team #1</label>
          <input class="input" id="starting-score-team1" type="text" placeholder="e.g., 50" style="background: #2a2a38; color: #E8E8E8; border: 2px solid #3a3a4a; border-radius: 6px;" />
        </div>
        <div class="field">
          <label class="label" style="color: #FFD700; font-weight: 600;">Starting Score - Team #2</label>
          <input class="input" id="starting-score-team2" type="text" placeholder="e.g., 45" style="background: #2a2a38; color: #E8E8E8; border: 2px solid #3a3a4a; border-radius: 6px;" />
        </div>
        <div class="field">
          <label class="label" style="color: #FFD700; font-weight: 600;">Quarter</label>
          <input class="input" id="starting-quarter" type="text" placeholder="e.g., 3" style="background: #2a2a38; color: #E8E8E8; border: 2px solid #3a3a4a; border-radius: 6px;" />
        </div>
        <div class="field">
          <label class="label" style="color: #FFD700; font-weight: 600;">Time (MMSS)</label>
          <input class="input" id="starting-time" type="text" placeholder="e.g., 0730 for 7:30" style="background: #2a2a38; color: #E8E8E8; border: 2px solid #3a3a4a; border-radius: 6px;" />
        </div>
     </section>
      <footer class="modal-card-foot" style="display: flex; gap: 12px; justify-content: space-between;">
        <button class="button is-success" onClick="TEAM_SELECTOR.changeTeams()" style="flex: 1; background: linear-gradient(145deg, #10B981 0%, #059669 100%); color: white; font-weight: 700; font-size: 16pt; padding: 24px 48px; border: none; border-radius: 8px; cursor: pointer; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);">Select Teams</button>
        <button class="button" onClick="TEAM_SELECTOR.selectRandomTeams()" style="flex: 1; background: linear-gradient(145deg, #8B5CF6 0%, #6D28D9 100%); color: white; font-weight: 700; font-size: 16pt; padding: 24px 48px; border: none; border-radius: 8px; cursor: pointer; box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);">üé≤ Random Teams</button>
      </footer>
    </div>
  </div>
</body>
</html>
